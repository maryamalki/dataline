# Text To SQL

![Screenshot of Text2SQL React app showing the generated SQL query and results from a natural language query on the dvdrentals database.](./images/limit_example.jpg)

## What is it?
An app that plugs into your database and uses the schema information to generate SQL queries for you out of natural language queries!


More technically, it's an interface for using LLMs with context for SQL query generation and execution.
The application flow is 1) connect your database 2) start querying.

![Screenshot of Text2SQL React app showing the connection page with multiple DSNs.](./images/connection.jpg)


This allows the app to fetch the table schemas from the database, create an index of {word vector: schema} out of them, then respond to queries by sending the "relevant" parts of your database schema to the LLM as context.


<br/>

## Why is this useful?

Can't we just send our database schema as context to an LLM? Yes, if it's small enough. But also, sending extra information might hurt the prompt quality.
We assume that sending just the right parts of the schema improves the results generally.

<br/>


## What can it do?

It can auto-execute queries and limit the results, or simply return the generated SQL query for the user to do what they please with.

Confession: I still don't know what's in this DVDRENTAL sample database OR how it's structured, which makes it all the more interesting to get results from natural language queries. Exploring a database with natural language questions is as smooth as it gets!


### Here is an example without auto execution:


![Screenshot of Text2SQL React app showing the generated SQL query without results.](./images/without_auto_execute.jpg)

### Here is an example with slightly inaccurate wording (highest rented) and with no indication as to how the database is structured. The limit here is generated by the query, so the user-inputted limit is ignored.


![Screenshot of Text2SQL React app showing another example generated SQL query with results.](./images/most_rented_actors.jpg)

This isn't satisfactory enough, so let's ask it to bring in their names as well!
![Screenshot of Text2SQL React app showing another example generated SQL query with results and more details.](./images/most_rented_actors_with_names.jpg)



## Where is this going?

As LLMs become more available, I hope to get help maintaining this to become a local app for exploring DBs with the power of LLMs. To run this as of now, you need an OpenAI API key. I've tried it with all the hosted models, and none other than the most expensive yield satisfactory results. I think this will change very soon however! Just this week StabilityAI released their models to all, and some weeks ago LLama was introduced. Things are moving very fast in this space, and before we know it we'll have very capable LLMs running locally!

This MVP requires some refactoring to be able to plug and play with different LLM configs, so that's the natural next step. Feel free to contribute! We can communicate via issues, and if people are interested I'll add a contribution guide.


## What is this based on?

This is based on the amazing Llamaindex and Langchain, which made it very easy to build the backend part of this in just one day. Wrapping it with a sleek UI took a bit longer however.

Here is a guide to a slightly simpler version of what the text2sql backend does: https://gpt-index.readthedocs.io/en/latest/guides/tutorials/sql_guide.html



### Running this

For the backend, simple FastAPI app with poetry. Make sure you have the latest poetry installed, and an OPENAI API KEY configured in your .env file as (OPENAI_API_KEY=...):

```bash
poetry install
uvicorn main:app --reload --port=7377
```

For the frontend, React app with npm (started off as Svelte, then moved to React to allow more people to contribute)
```bash
npm i
npm run dev
```

Let me know if I missed anything in the installation steps, didn't invest too much time testing this as I have it already running.
